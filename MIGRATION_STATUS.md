# FormOnce Supabase ç§»è¡Œã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

æœ€çµ‚æ›´æ–°: 2025-10-30

## âœ… å®Œäº†ã—ãŸä½œæ¥­

### 1. Supabaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå**: formonce-test
- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID**: rmldynmhlrllervplyxq
- **ãƒªãƒ¼ã‚¸ãƒ§ãƒ³**: ap-northeast-1 (æ±äº¬)
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ACTIVE_HEALTHY

### 2. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š
`.env` ãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ã‚’è¿½åŠ æ¸ˆã¿ï¼š

```bash
# Supabase Database
DATABASE_URL="postgresql://postgres:***@db.rmldynmhlrllervplyxq.supabase.co:5432/postgres?pgbouncer=true&connection_limit=1"
DIRECT_URL="postgresql://postgres:***@db.rmldynmhlrllervplyxq.supabase.co:5432/postgres"

# Supabase API
NEXT_PUBLIC_SUPABASE_URL="https://rmldynmhlrllervplyxq.supabase.co"
NEXT_PUBLIC_SUPABASE_ANON_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
```

### 3. ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
âœ… @supabase/supabase-js
âœ… @supabase/auth-helpers-nextjs
```

### 4. Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ
- âœ… `src/lib/supabase.ts` - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç”¨Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
- âœ… `src/lib/supabase-server.ts` - ã‚µãƒ¼ãƒãƒ¼ç”¨Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

### 5. Prismaã‚¹ã‚­ãƒ¼ãƒã®æ›´æ–°
- âœ… `directUrl` è¨­å®šã‚’è¿½åŠ ï¼ˆSupabase Connection Poolerå¯¾å¿œï¼‰
- âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒé©ç”¨å®Œäº†ï¼ˆ15ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰

### 6. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šç¢ºèª
- âœ… Supabase PostgreSQLã«æ¥ç¶šæˆåŠŸ
- âœ… Prismaã‚¹ã‚­ãƒ¼ãƒã¨åŒæœŸæ¸ˆã¿

---

## ğŸš§ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆæ®µéšçš„ç§»è¡Œï¼‰

### ãƒ•ã‚§ãƒ¼ã‚º1: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãƒ†ã‚¹ãƒˆï¼ˆæœ€å„ªå…ˆï¼‰
ç¾åœ¨ã®çŠ¶æ…‹ã§æ—¢ã«Supabaseãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ¥ç¶šã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€å‹•ä½œç¢ºèªã‚’è¡Œã„ã¾ã™ã€‚

**ã‚„ã‚‹ã“ã¨:**
1. ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ï¼ˆæ—¢ã«èµ·å‹•ã—ã¦ã„ã‚‹å ´åˆã¯å†èµ·å‹•ï¼‰
   ```bash
   pnpm dev
   ```
2. ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:3000 ã‚’é–‹ã
3. æ—¢å­˜ã®æ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã‹ç¢ºèª

**æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ:**
- NextAuthèªè¨¼ãŒå‹•ä½œã™ã‚‹ï¼ˆSupabaseãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½¿ç”¨ï¼‰
- ãƒ•ã‚©ãƒ¼ãƒ ã®ä½œæˆãƒ»ç·¨é›†ãŒå‹•ä½œã™ã‚‹
- ãƒ‡ãƒ¼ã‚¿ãŒSupabase PostgreSQLã«ä¿å­˜ã•ã‚Œã‚‹

---

### ãƒ•ã‚§ãƒ¼ã‚º2: Authenticationï¼ˆNextAuth â†’ Supabase Authï¼‰
**çŠ¶æ…‹**: æœªå®Ÿæ–½ï¼ˆNextAuthã¯ç¾åœ¨ã‚‚å‹•ä½œä¸­ï¼‰

**å¿…è¦ãªä½œæ¥­:**
1. Supabase Dashboard ã§OAuthãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’è¨­å®š
   - Google OAuthè¨­å®š
   - GitHub OAuthè¨­å®š
   - Email/Passwordèªè¨¼è¨­å®š

2. èªè¨¼é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ:
   - `src/app/api/auth/callback/route.ts`ï¼ˆOAuth ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
   - `src/app/api/auth/signout/route.ts`ï¼ˆã‚µã‚¤ãƒ³ã‚¢ã‚¦ãƒˆï¼‰
   - `src/hooks/useAuth.ts`ï¼ˆèªè¨¼ãƒ•ãƒƒã‚¯ï¼‰

3. èªè¨¼ãƒšãƒ¼ã‚¸ã®æ›¸ãæ›ãˆ:
   - `src/pages/auth/signin.tsx`
   - `src/pages/auth/signup.tsx`

4. tRPCèªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®æ›´æ–°:
   - `src/server/api/trpc.ts`

**æ³¨æ„äº‹é …:**
- NextAuthã®è¨­å®šã¯æ®‹ã—ãŸã¾ã¾ã€ä¸¦è¡Œã—ã¦Supabase Authã‚’å®Ÿè£…
- å®Œå…¨ã«å‹•ä½œç¢ºèªå¾Œã€NextAuthã‚’å‰Šé™¤

---

### ãƒ•ã‚§ãƒ¼ã‚º3: Storageï¼ˆBackblaze B2 â†’ Supabase Storageï¼‰
**çŠ¶æ…‹**: æœªå®Ÿæ–½

**å¿…è¦ãªä½œæ¥­:**
1. Supabase Storageãƒã‚±ãƒƒãƒˆã®ä½œæˆ
   - ãƒã‚±ãƒƒãƒˆå: `uploads`
   - RLSãƒãƒªã‚·ãƒ¼è¨­å®š

2. ãƒ“ãƒ‡ã‚ªã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ã®æ›¸ãæ›ãˆ:
   - `src/server/api/routers/video/router.ts`

3. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ›´æ–°

**æ³¨æ„äº‹é …:**
- Bunny.netï¼ˆãƒ“ãƒ‡ã‚ªCDNï¼‰ã¯ç¶™ç¶šä½¿ç”¨
- Supabase Storageã¯ä¸€æ™‚ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å…ˆã¨ã—ã¦ä½¿ç”¨

---

## ğŸ“Š ç¾åœ¨ã®çŠ¶æ…‹

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | ç§»è¡Œå‰ | ç¾åœ¨ | æœ€çµ‚ç›®æ¨™ |
|-------------|--------|------|---------|
| Database | Neon | **Supabase** âœ… | Supabase |
| ORM | Prisma | **Prisma** âœ… | Prisma |
| Auth | NextAuth | **NextAuth** âš ï¸ | Supabase Auth |
| Storage | Backblaze B2 | **Backblaze B2** âš ï¸ | Supabase Storage |
| Video CDN | Bunny.net | **Bunny.net** âœ… | Bunny.net |

**å‡¡ä¾‹:**
- âœ… = ç§»è¡Œå®Œäº†
- âš ï¸ = ç§»è¡Œå‰ï¼ˆæ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ä½¿ç”¨ä¸­ï¼‰
- ğŸš§ = ç§»è¡Œä½œæ¥­ä¸­

---

## ğŸ” å‹•ä½œç¢ºèªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š
- [ ] `pnpm dev` ã§ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
- [ ] ã‚¨ãƒ©ãƒ¼ãªãèµ·å‹•ã™ã‚‹
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãŒæˆåŠŸã™ã‚‹

### æ—¢å­˜æ©Ÿèƒ½ã®å‹•ä½œç¢ºèª
- [ ] ã‚µã‚¤ãƒ³ã‚¤ãƒ³/ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ãŒå‹•ä½œã™ã‚‹
- [ ] ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆãŒå‹•ä½œã™ã‚‹
- [ ] ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ç®¡ç†ãŒå‹•ä½œã™ã‚‹
- [ ] ãƒ‡ãƒ¼ã‚¿ãŒSupabaseã«ä¿å­˜ã•ã‚Œã‚‹

### Prisma Studioç¢ºèª
```bash
pnpx prisma studio
```
- [ ] Prisma StudioãŒèµ·å‹•ã™ã‚‹
- [ ] ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹

---

## âš ï¸ æ—¢çŸ¥ã®å•é¡Œ

### Prisma Clientç”Ÿæˆã‚¨ãƒ©ãƒ¼
**ç—‡çŠ¶:**
```
EPERM: operation not permitted, rename 'query-engine-windows.exe.tmp'
```

**åŸå› :**
- é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ä¸­ã§ãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹
- ã‚¦ã‚¤ãƒ«ã‚¹å¯¾ç­–ã‚½ãƒ•ãƒˆãŒãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒ–ãƒ­ãƒƒã‚¯

**å¯¾å‡¦æ–¹æ³•:**
1. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’åœæ­¢ã™ã‚‹
2. VSCodeã‚’å†èµ·å‹•ã™ã‚‹
3. ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œ:
   ```bash
   pnpm install
   pnpx prisma generate
   ```

**å½±éŸ¿:**
ç¾æ™‚ç‚¹ã§ã¯å½±éŸ¿ãªã—ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã¯æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™ã€‚

---

## ğŸ“ æ¬¡å›ä½œæ¥­æ™‚ã®æ‰‹é †

### 1. å‹•ä½œç¢ºèªï¼ˆæœ€å„ªå…ˆï¼‰
```bash
# 1. ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
pnpm dev

# 2. ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã
http://localhost:3000

# 3. æ—¢å­˜æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆ
- ã‚µã‚¤ãƒ³ã‚¤ãƒ³/ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—
- ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆ
- ãƒ‡ãƒ¼ã‚¿ä¿å­˜ç¢ºèª
```

### 2. ãƒ•ã‚§ãƒ¼ã‚º2ï¼ˆAuthenticationç§»è¡Œï¼‰ã‚’é–‹å§‹ã™ã‚‹å ´åˆ

#### 2-1. Supabase Dashboardè¨­å®š
1. https://app.supabase.com/ ã«ã‚¢ã‚¯ã‚»ã‚¹
2. formonce-test ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹ã
3. Authentication â†’ Providers
4. Googleã€GitHubã€Emailèªè¨¼ã‚’è¨­å®š

#### 2-2. ã‚³ãƒ¼ãƒ‰å®Ÿè£…
ç§»è¡Œã‚¬ã‚¤ãƒ‰ï¼ˆSUPABASE_MIGRATION_GUIDE.mdï¼‰ã®ã€Œèªè¨¼ã®ç§»è¡Œã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§

---

## ğŸ¯ æœ€çµ‚ç›®æ¨™

å®Œå…¨ã«Supabaseã«ç§»è¡Œã—ãŸçŠ¶æ…‹ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         FormOnce (Next.js)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Database:  Supabase PostgreSQL âœ…       â”‚
â”‚ Auth:      Supabase Auth       ğŸš§       â”‚
â”‚ Storage:   Supabase Storage    ğŸš§       â”‚
â”‚ Video CDN: Bunny.net           âœ…       â”‚
â”‚ ORM:       Prisma              âœ…       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆï¼š
1. `SUPABASE_MIGRATION_GUIDE.md` ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’ç¢ºèª
2. Supabase Dashboard â†’ Logs ã§ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª
3. GitHub Issuesã§å ±å‘Š

---

**ä½œæ¥­æ‹…å½“**: Claude Code
**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: FormOnce
**ç§»è¡Œé–‹å§‹æ—¥**: 2025-10-30
**ç§»è¡Œæ–¹å¼**: æ®µéšçš„ç§»è¡Œï¼ˆDatabase â†’ Auth â†’ Storageï¼‰
