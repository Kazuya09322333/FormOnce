# FormOnce 選択肢管理ガイド

FormOnceの選択肢作成・編集機能の完全ガイドです。

---

## ✅ 既に実装済み！

選択肢の**追加・削除・編集**機能は完全に実装されており、すぐに使えます！

---

## 🎯 選択肢管理の場所

### 1. 新しい質問を作成する時

**Flow Builder**から：
1. 空白部分をダブルクリック
2. または「+」ボタンをクリック
3. 質問タイプで「選択式」を選択
4. 選択肢を編集

### 2. 既存の質問を編集する時

**QuestionNode**から：
1. 質問ノードの右側をクリック
2. 「Answer」ボタンをクリック
3. 選択肢を編集
4. 「質問を編集」をクリック

---

## 📝 選択肢の追加方法

### ステップバイステップ

1. **初期状態**
   - デフォルトで2つの選択肢が表示される
   - 「Option 1」「Option 2」

2. **選択肢を追加**
   - 選択肢リストの下にある「➕」ボタンをクリック
   - 新しい選択肢「選択肢」が追加される
   - **制限なし！** 好きなだけ追加可能

3. **テキストを編集**
   - 各選択肢の入力欄をクリック
   - テキストを入力（例: 「スニーカー」「サンダル」）
   - リアルタイムで保存される

4. **最低2つ必要**
   - 選択肢は最低2つ必要
   - 2つ未満の場合、保存できない

---

## 🗑️ 選択肢の削除方法

### 削除ボタン

1. 各選択肢の右側に「🗑️」ゴミ箱アイコンがある
2. クリックすると即座に削除される
3. 最後の2つは削除できない（最低2つ必要）

### 注意事項
- 削除は即座に反映される（元に戻せない）
- 削除した選択肢を使用するロジックがある場合、そのロジックは機能しなくなる

---

## ✏️ 選択肢のテキスト編集

### 編集方法

1. 選択肢の入力欄をクリック
2. テキストを編集
3. 自動保存（フォーム送信時）

### ベストプラクティス

✅ **良い例:**
- 「スニーカー」
- 「サンダル」
- 「ブーツ」

❌ **避けるべき例:**
- 「選択肢1」（意味不明）
- 「その他」のみ（具体性がない）
- 空白（エラーになる）

---

## 🔀 複数選択 vs 単一選択

### 単一選択（Single Select）

- **デフォルト設定**
- ユーザーは1つだけ選択可能
- 選択後**300msで自動的に次の質問へ**
- VideoAsk風の流れるような体験

**使用例:**
- 「性別を選択してください」
- 「好きな色は？」
- 「配送方法は？」

### 複数選択（Multiple Select）

- 「複数選択を許可」スイッチをON
- ユーザーは複数選択可能
- 「次へ」ボタンを押すまで待機

**使用例:**
- 「興味のある商品カテゴリーは？（複数可）」
- 「該当する項目をすべて選択してください」
- 「どのSNSを使っていますか？」

---

## 🎨 UI実装の詳細

### コンポーネント構造

**ファイル**: `src/components/form-builder/select-question-form.tsx`

```typescript
// useFieldArrayで動的配列を管理
const { fields, append, remove } = useFieldArray({
  control: form.control,
  name: 'options',
  rules: {
    minLength: {
      value: 2,
      message: '最低2つの選択肢が必要です',
    },
  },
})
```

### 選択肢の表示

```tsx
{fields.map((field, index) => (
  <FormField
    key={field.id}
    control={form.control}
    name={`options.${index}`}
    render={({ field }) => (
      <FormItem>
        <div className="flex gap-2">
          {/* 入力欄 */}
          <FormControl>
            <Input
              type="text"
              placeholder="選択肢を入力"
              {...field}
            />
          </FormControl>

          {/* 削除ボタン */}
          <Button
            type="button"
            size="icon"
            variant={'ghost'}
            onClick={() => remove(index)}
          >
            <Icons.trash className="h-5 w-5" />
          </Button>
        </div>
      </FormItem>
    )}
  />
))}
```

### 追加ボタン

```tsx
<Button
  type="button"
  size="icon"
  variant="ghost"
  onClick={() => append('選択肢')}
>
  <Icons.plus className="h-5 w-5" />
</Button>
```

---

## 🔗 選択肢と分岐ロジックの連携

### 自動反映

選択肢を追加・削除すると、**ロジック設定画面にも自動的に反映**されます！

**例:**
```
質問: 「どの商品に興味がありますか？」

選択肢を追加:
  1. スニーカー
  2. サンダル
  3. ブーツ ← 新規追加

↓ 自動的に

ロジック設定画面:
  ☐ A. スニーカー
  ☐ B. サンダル
  ☐ C. ブーツ ← 自動的に表示される！
```

### Logic Builder UI

**ファイル**: `src/components/form-builder/flow-builder/logic-builder.tsx`

```tsx
{question.options.map((option, i) => (
  <div className="flex rounded-md p-3">
    <label>
      {/* A, B, C... のラベル */}
      <span>{String.fromCharCode(65 + i)}</span>

      {/* 選択肢のテキスト */}
      <span>{option}</span>
    </label>

    {/* チェックボックス */}
    <Checkbox
      checked={field.value.includes(option)}
      onCheckedChange={...}
    />
  </div>
))}
```

---

## 📊 選択肢の数と分岐の関係

### 基本的な考え方

- **選択肢の数 = 分岐の最大数**
- 各選択肢ごとに異なる質問へ分岐可能
- 複数の選択肢を同じ分岐先にすることも可能

### 例: 3つの選択肢 → 3つの分岐

```
質問: 「どの商品に興味がありますか？」

選択肢:
  A. スニーカー
  B. サンダル
  C. ブーツ

分岐ロジック:
  1. IS_ONE_OF [A. スニーカー] → 質問2（スニーカー詳細）
  2. IS_ONE_OF [B. サンダル] → 質問3（サンダル詳細）
  3. IS_ONE_OF [C. ブーツ] → 質問4（ブーツ詳細）
```

### 例: 複数選択肢 → 同じ分岐先

```
質問: 「年齢層を選択してください」

選択肢:
  A. 10代
  B. 20代
  C. 30代
  D. 40代以上

分岐ロジック:
  1. IS_ONE_OF [A, B] → 質問5（若年層向け）
  2. IS_ONE_OF [C, D] → 質問6（中高年層向け）
```

---

## 🎯 実際の使用例

### 例1: ECサイトの商品カテゴリー選択

```
質問1: 「どのカテゴリーに興味がありますか？」

【選択肢の作成】
1. ➕ボタンをクリック
2. 以下を入力:
   - メンズファッション
   - レディースファッション
   - キッズファッション
   - スポーツ・アウトドア
   - 家電・カメラ

【ロジック設定】
- メンズファッション → 質問2（メンズ商品一覧）
- レディースファッション → 質問3（レディース商品一覧）
- ...各カテゴリーごとに設定

【動作】
ユーザーが「メンズファッション」をクリック
  → 300ms後に自動的に質問2へ
  → メンズファッションの動画が自動再生
```

### 例2: カスタマーサポートの問い合わせ分類

```
質問1: 「お問い合わせ内容を選択してください」

【選択肢の作成】
- 配送について
- 返品・交換について
- 商品について
- 支払いについて
- その他

【ロジック設定】
- 配送について → 質問10（配送専用フォーム）
- 返品・交換について → 質問11（返品専用フォーム）
- その他 → 質問20（フリー入力）

【動作】
適切な担当者へ自動振り分け
```

### 例3: 診断フォーム

```
質問1: 「肌の悩みは？（複数選択可）」

【複数選択をON】
「複数選択を許可」スイッチをON

【選択肢の作成】
- 乾燥
- オイリー
- ニキビ
- シミ・くすみ
- シワ・たるみ

【ロジック設定】
- 乾燥が含まれる → 質問5（保湿ケア）
- オイリーが含まれる → 質問6（皮脂コントロール）

【動作】
複数の悩みに対応した総合的な診断結果
```

---

## ⚠️ よくある質問

### Q1: 選択肢は何個まで追加できる？
**A:** 制限はありません。ただし、多すぎるとUIが見づらくなるため、5-10個程度が推奨です。

### Q2: 選択肢の順番を変更できる？
**A:** 現在は削除→再追加で対応してください。ドラッグ&ドロップは将来のアップデートで実装予定です。

### Q3: 選択肢を削除すると分岐ロジックはどうなる？
**A:** その選択肢を使用するロジックは機能しなくなります。削除前にロジック設定を確認してください。

### Q4: 画像を選択肢として使える？
**A:** 現在はテキストのみです。画像選択肢は将来のアップデートで実装予定です。

### Q5: 選択肢の文字数制限は？
**A:** 特に制限はありませんが、長すぎるとUIが崩れる可能性があります。50文字以内が推奨です。

---

## 🛠️ トラブルシューティング

### 問題: 選択肢が追加できない

**原因**: 最大数に達している（ブラウザの制限）
**解決**: ページをリロードしてください

### 問題: 削除ボタンが効かない

**原因**: 最後の2つの選択肢
**解決**: 選択肢は最低2つ必要です

### 問題: 選択肢の変更が保存されない

**原因**: フォームを送信していない
**解決**: 「質問を編集」ボタンをクリックしてください

---

## 📚 関連ドキュメント

- [BRANCHING_LOGIC_GUIDE.md](./BRANCHING_LOGIC_GUIDE.md) - 分岐ロジックの詳細
- [PRODUCT_ROADMAP.md](./PRODUCT_ROADMAP.md) - プロダクトロードマップ
- [MVP_COMPLETE.md](./MVP_COMPLETE.md) - MVP完了機能一覧

---

## 🎉 まとめ

FormOnceの選択肢管理機能は：

✅ **完全に実装済み**
✅ **追加・削除・編集が簡単**
✅ **分岐ロジックと自動連携**
✅ **VideoAsk風の自動遷移**
✅ **単一選択・複数選択に対応**

今すぐ使えます！素晴らしいフォームを作成しましょう！🚀
